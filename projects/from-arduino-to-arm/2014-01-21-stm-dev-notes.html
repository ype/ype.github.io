<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content="arm cortex-m linux stm32 arm architecture gnu toolchain microcontroller open source gnu">
<meta property="article:tag" content="arm cortex-m">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="stm32">
<meta property="article:tag" content="arm architecture">
<meta property="article:tag" content="gnu toolchain">
<meta property="article:tag" content="microcontroller">
<meta property="article:tag" content="open source">
<meta property="article:tag" content="gnu">
<title>(y_pe (STM32 Development: Intro))</title>
<Link href="/assets/scss/application.css" media="screen, projection" rel="stylesheet" type="text/css" />
<Link href="/assets/scss/screen.css" media="screen, projection" rel="stylesheet" type="text/css" />
<link href="/assets/scss/print.css" media="print" rel="stylesheet" type="text/css" />
<!--[if lt IE 8]>
    <link href="/assets/scss/ie.css" media="screen, projection" rel="stylesheet" type="text/css" />
    <![endif]-->

<!-- you don't need to keep this, but it's cool for stats! -->
<meta name="generator" content="nanoc 3.6.7">

<link rel="icon" type="image/png" href="/assets/icons/47-ico.ico">

<div class="page con-background">
  
<div id="sidebar">
  <nav class="sidebar">
    <div class="sidebar-content">
      <img src="/assets/img/isotypes/321.png" style="height: auto; width: auto; max-height: 128px; padding: 10px;" alt="isotyperwriter"/>
      <ul>
	<li class="brand"><a data-instant="" href="/">y_pe</a></li>
      </ul>
      <div class="articles">
	<ul id="articles">
	  <li><a data-instant="" href="/about">About</a></li>
	  <li><a data-instant="" href="/archive">Archive</a></li>
	  <dl class="accordion">
	    <dt id="recent"><a href="">Recent Articles</a></dt>
	    
	    <dd>
	      <li>
		<aside class="created_at">22-01-2014</aside>
		<a data-instant="" href="/projects/from-arduino-to-arm/2014-01-21-stm-dev-notes.html">STM32 Development: Intro</a>
	      </li>
	    </dd>
	    
	    <dd>
	      <li>
		<aside class="created_at">08-11-2013</aside>
		<a data-instant="" href="/posts/2013-11-08-problematic-procrastination/">Problematic Procrastination</a>
	      </li>
	    </dd>
	    
	    <dd>
	      <li>
		<aside class="created_at">04-11-2013</aside>
		<a data-instant="" href="/posts/2013-11-04-virtually-a-new-beginning/">virtually, a new beginning</a>
	      </li>
	    </dd>
	    
	    <br />
	    <hr />
	    <dt><a href="">Projects</a></dt>
	    <dd><li><a data-instant="" href="/projects/from-arduino-to-arm">From Arduino to ARM</a></li></dd>
	    <dd><li><a data-instant="" href="/projects/lisp-apps-on-the-infobahn">Lisp Apps on the InfoBahn</a></li></dd>
	    <br />
	  </dl>
	</ul>
      </div>
    </div>
  </nav>
</div>


  <div class="content">
    <div class="push">
      <header>
    <h1 class="title">STM32 Development: Intro</h1>
    <h1 class="subtitle"></h1>
    <h3 class="date">22-01-2014</h3>
    <p>Tags: <a href="/tags/ARM" rel="tag">ARM</a>, <a href="/tags/embedded" rel="tag">embedded</a></p>
</header>

      
      <p>This article will go through the required steps to setup an
  environment for writing, programming, and debugging code for ARM
  Cortex-M processor. As I am predominately a OS X user (sometimes Linux
  depending on my mood) the information provided is tailored towards OS
  X users, however, as all of the tools used in the setup are
  open-source, the information should be transferable to other
  platforms.</p>
<div class="section" id="setup">
<h1>Setup</h1>
<div class="section" id="parts-list">
<h3>Parts List</h3>
<p><a href="http://uk.farnell.com/stmicroelectronics/stm32vldiscovery/stm32f100-st-link-discovery-kit/dp/1824325">ST STM32VL-DISCOVERY board</a></p>
<ul>
<li>or any other ARM Cortex-M Processor, however most of the examples
    shown will be for the STM32VL</li>
</ul>
<p><a href="http://uk.farnell.com/jsp/search/productdetail.jsp?SKU=1892523">ST-Link/v2</a> (or other compatible ICD/Programmer, for STM32)</p>
<ul>
<li>NOTE: If you have the STM32VL-Discovery board, there is an
    ST-Link built-in, and it is not required to get an external
    ST-Link, however if you plan on developing custom projects built
    around the ST range of microcontrollers it may be worth to get
    one.</li>
</ul>
<p><b>You will also need:</b></p>
<ul>
<li>Wires, LED and other components you may want to play around with,
    note that for each example I will list the parts used with links to
    where you can get them.</li>
  <li>A computer, but given you are reading this I am going to assume you
    have one.</li>
</ul>
</div>
<div class="section" id="toolchain">
<h3>Toolchain</h3>
<div class="section" id="homebrew-installation">
<h5>Homebrew installation</h5>
<p>To manage packages on my mac (OS X 10.9), I use homebrew, so I will
  show you how to set that up, however if you are on Linux, or prefer a
  different package manager (i.e. macports), most of these packages
  should be available. You can also alternatively install all of these
  packages manually, though I would advise against it, as in my
  experience it can be a road riddled with bugs.</p>
<p><span style="text-decoration:underline;">Homebrew install</span></p>
<div class="highlight"><pre><span class="nv">$ </span>ruby -e <span class="s2">"$(curl -fsSL https://raw.github.com/mxcl/homebrew/go)"</span>    
<span class="nv">$ </span>brew doctor
</pre></div>
</div>
<div class="section" id="gcc-arm-none-eabi-install">
<h5>gcc-arm-none-eabi install</h5>
<p>You are going to need a compiler to generate your object code that
  will be loaded onto your microcontroller. To do this you are going to
  need a toolchain. The GNU toolchain for ARM Cortex-M and Cortex-R
  processors is really great, and can be easily installed using
  homebrew.</p>
<p>(Note: you can use an IDE for ARM development, however the examples
  and instructions here are built around the GNU ARM toolchain. Further,
  if you are developing on OS X or Linux IDE support for ARM development
  is limited with most being built specifically for Windows)</p>
<p><span style="text-decoration:underline;">Installing the GNU Toolchain with Homebrew</span></p>
<div class="highlight"><pre><span class="nv">$ </span>brew install https://raw.github.com/PX4/homebrew-px4/master/gcc-arm-none-eabi-47.rb    
</pre></div>
<hr>
</div>
</div>
<div class="section" id="st-link">
<h3>ST-LINK</h3>
<p>The ST-Link (or compatible ICD/Programmer) is essential for ARM
  microcontroller development. It is an in-circuit debugger and
  programmer for the STM8 and STM32 microntroller families.</p>
<div class="section" id="installing-st-link-utils-using-homebrew">
<h5>Installing ST-Link Utils using Homebrew</h5>
<div class="highlight"><pre><span class="nv">$ </span>brew install automake autoconf libusb libusb-compat    
<span class="nv">$ </span>sudo easy_install pyyaml
<span class="nv">$ </span>mkdir ~/Development 
<span class="nv">$ </span><span class="nb">cd</span> ~/Development
<span class="nv">$ </span>mkdir ~/Development/embedded
<span class="nv">$ </span><span class="nb">cd</span> ~/Development/embedded
<span class="nv">$ </span>mkdir ~/Development/embedded/tools
<span class="nv">$ </span><span class="nb">cd</span> ~/Development/embedded/tools
<span class="nv">$ </span>git clone https://github.com/texane/stlink.git    
<span class="c">#ST-LINK command line utility</span>
<span class="c">#Source: https://github.com/texane/stlink</span>
<span class="nv">$ </span><span class="nb">cd</span> ~/Development/embedded/tools/stlink/    
<span class="nv">$ </span>./autogen.sh
<span class="nv">$ </span>./configure
<span class="nv">$ </span>make 
</pre></div>
</div>
<div class="section" id="extra-configurations-for-st-link-v1">
<h5>Extra Configurations for ST-Link/v1</h5>
<p>The ST-Link/v1’s SCSI emulation is very broken, You will need to tell
  your operating system to ignore the ST-Link/v1, as the SCSI emulation
  on it doesn’t play nice with UNIX systems.</p>
<p><span style="text-decoration:underline;">Do one of the following before using your ST-Link</span></p>
<p><b>Option 1:</b></p>
<div class="highlight"><pre><span class="nv">$ </span>modprobe -r usb-storage
<span class="nv">$ </span>modprobe usb-storage <span class="nv">quirks</span><span class="o">=</span>483:3744:i    
</pre></div>
<p><b>Option 2:</b></p>
<div class="highlight"><pre><span class="c">#add "options usb-storage quirks=483:3744:i" to /etc/modprobe.conf    </span>
<span class="c">#then</span>
<span class="nv">$ </span>modprobe -r usb-storage
<span class="nv">$ </span>modprobe usb-storage
</pre></div>
<p><b>Option 3:</b></p>
<div class="highlight"><pre><span class="nv">$ </span>cp stlink_v1.modprobe.conf /etc/modprobe.d     
<span class="c">#then</span>
<span class="nv">$ </span>modprobe -r usb-storage 
<span class="nv">$ </span>modprobe usb-storage
</pre></div>
</div>
<div class="section" id="notes-for-st-link-v2">
<h5>Notes for  ST-Link/v2</h5>
<p>The ST-Link/v2 should work right away, nevertheless, doing the above
  fix for STLINKv1 won’t hurt anything and will prevent you from having
  to do the work later if you are using an ST-Link/v1.</p>
</div>
<div class="section" id="using-st-util">
<h5>Using ST-Util</h5>
<ul>
<li>You must launch st-util with “-1” flag <a href="https://github.com/texane/stlink/issues/182">(source)</a>
</li>
</ul>
<div class="highlight"><pre><span class="nv">$ </span>/path_to_stlink/st-utils -1
<span class="c">#or if you have added the stlink folder to your path</span>
<span class="nv">$ </span>st-utils -1
</pre></div>
<hr>
</div>
</div>
</div><div class="section" id="setting-up-a-development-environment-for-stm32-projects">
<h1>Setting up a Development Environment for STM32 Projects</h1>
<div class="section" id="option-1-firmware-lib-simple">
<h3>Option 1, Firmware Lib =&gt; Simple</h3>
<div class="section" id="libopencm3">
<h5>libopencm3</h5>
<p>The libopencm3 project is a good place to start with ST
  programming. Featuring a large free/libre/open-source (LGPL v3, or
  later) firmware library for various ARM Cortex-M3 microcontrollers,
  including the ST STM32 range, libopencm3 offers examples, community
  and documentation to help for a smooth transition from Arduino to ARM.</p>
<p>To get more familiar with libopencm3 go to there main wiki @
  <a href="http://libopencm3.org/wiki/Main_Page">http://libopencm3.org/wiki/Main_Page</a></p>
</div>
<div class="section" id="libopencm3-quick-start">
<h5>libopencm3 quick start</h5>
<p>The code below will help you to setup a workflow to develop for ARM
  Cortex-M microcontrollers using the resources available from
  libopencm3.</p>
<div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> ~/Development/embedded/
<span class="nv">$ </span>git clone https://github.com/libopencm3/libopencm3-examples.git        
<span class="nv">$ </span><span class="nb">cd </span>libopencm3-examples
<span class="nv">$ </span>git submodule init
<span class="nv">$ </span>git submodule update
<span class="nv">$ </span>make
</pre></div>
<p><span style="text-decoration:underline;">Test to see everything works</span>
  (Note: The Example below is for the <a href="http://www.st.com/st-web-ui/static/active/en/resource/technical/document/user_manual/CD00267113.pdf">ST STM32VL-DISCOVERY board</a>)</p>
<div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>examples/stm32/f1/stm32vl-discovery/miniblink/    
<span class="nv">$ </span>make
<span class="nv">$ </span><span class="nb">cd</span> ~/Development/embedded/tools/stlink/    
<span class="nv">$ </span>./st-util
<span class="c">#Short way</span>
<span class="nv">$ </span>arm-none-eabi-gdb miniblink.elf -ex <span class="s2">"tar ext :4242"</span>    
<span class="o">(</span>gdb<span class="o">)</span> load
<span class="o">(</span>gdb<span class="o">)</span> <span class="k">continue</span>
</pre></div>
</div>
</div>
<div class="section" id="option-2-bare-metal-fiddly">
<h3>Option 2, Bare Metal =&gt; Fiddly</h3>
<ul>
<li>(Coming Soonish)</li>
</ul>
</div>
</div><div class="section" id="helpful-resources">
<h1>Helpful resources</h1>
<p>Here is a list of helpful links to tutorials and information to get
  you started on the path to development using ARM microcontrollers</p>
<ul>
<li>
<b>STM32 Open Source Course</b>
    <ul>
<li><a href="http://homes.soic.indiana.edu/geobrown/c335.php">Course Page</a></li>
      <li><a href="https://github.com/geoffreymbrown/STM32-Template">Build template for projects using the STM32VL-Discovery Board</a></li>
      <li>Book
        <ul>
<li><a href="http://www.cs.indiana.edu/~geobrown/book.pdf">Discovering the STM32 Microcontroller</a></li>
        </ul>
</li>
    </ul>
</li>
  <li>
<b>libopencm3</b>
    <ul>
<li><a href="http://libopencm3.org/wiki/Main_Page">Wiki - Main Project Page</a></li>
      <li><a href="https://github.com/libopencm3/libopencm3">github/libopencm3</a></li>
      <li><a href="https://github.com/libopencm3/libopencm3-examples">github/libopencm3-examples</a></li>
      <li><a href="http://libopencm3.github.io/docs/latest/stm32f1/html/modules.html">libopencm3 API Documentation</a></li>
    </ul>
</li>
  <li>
<b>Reference Manuals</b>
    <ul>
<li><a href="http://infocenter.arm.com/help/topic/com.arm.doc.ddi0337h/DDI0337H_cortex_m3_r2p0_trm.pdf">Cortex-M3 Reference Manual</a></li>
      <li><a href="http://www.st.com/web/en/resource/technical/document/reference_manual/CD00171190.pdf">RM0008: STM32F1xx</a></li>
      <li><a href="http://www.st.com/web/en/resource/technical/document/reference_manual/CD00246267.pdf">RM0041: STM32F100xx</a></li>
    </ul>
</li>
</ul>
</div>
      <div class="updated_on">
	<p style="font-size: 0.75em;">
	  updated on: <i>April 2, 2014</i>
	</p>
      </div>
      
	<div id="disqus_thread"></div>
      
    </div>
  </div>
</div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'isotype'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
<script src="/assets/js/instantclick.min.js" data-no-instant>
	      InstantClick.init();
</script>

<script>
 (function($) {

   var allPanels = $('.accordion > dd').hide();

   $('.accordion > dt > a').click(function() {
     allPanels.slideUp('ease');

     if($(this).parent().nextUntil( "br" ).is(':hidden')) {
       $(this).parent().nextUntil( "br" ).slideDown('slow');
     }
     return false;
   });

 })(jQuery);
</script>

<script data-no-instant>
 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-45893163-4']);
 _gaq.push(['_trackPageview']);
 (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;

   ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';

   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 })();

 InstantClick.on('change', function() {
  ga('send', 'pageview', location.pathname + location.search);
});

InstantClick.init();
</script>
    
</body>
</html>
